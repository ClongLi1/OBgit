<%*
// ===== 工具函数 =====
Function 获取当前日期 () {
  Const 文件名 = tp. File. Title;
  Const 日期匹配 = 文件名.Match (/(\d{4})-? (\d{2})-? (\d{2})/);
  Return 日期匹配 ? New Date (`${日期匹配[1]}-${日期匹配[2]}-${日期匹配[3]}`) : new Date ();
}

Function 生成进度条 (百分比, 长度=20) {
  Const 剩余比例 = 100 - 百分比;
  Const 剩余格子 = Math.Floor (剩余比例/100 * 长度);
  
  // 红绿灯三色：
  Const 颜色 = 
    剩余比例 > 60 ? " #4CAF50 " :  // 绿（安全）
    剩余比例 > 30 ? " #FFC107 " :  // 黄（警告）
    " #F44336 ";                   // 红（危险）

  return `│<span style="color:#E0E0E0">${"░".Repeat (长度 - 剩余格子)}</span>` +
         `<span style="color:${颜色}">${"█".Repeat (剩余格子)}</span>│`;
}

// ===== 主计算逻辑 =====
Const 当前日期 = 获取当前日期 ();
Const 当前年份 = 当前日期.GetFullYear ();

// 1. 年进度
Const 年初 = new Date (当前年份, 0, 1);
Const 年末 = new Date (当前年份, 11, 31);
Const 全年天数 = Math.Floor ((年末 - 年初) / 86400000 + 1);
Const 已过天数 = Math.Floor ((当前日期 - 年初) / 86400000 + 1);
Const 剩余天数 = 全年天数 - 已过天数;

// 2. 月进度
Const 当月天数 = new Date (当前年份, 当前日期.GetMonth () + 1, 0). GetDate ();
Const 已过当月天数 = 当前日期.GetDate ();
Const 剩余当月天数 = 当月天数 - 已过当月天数;

// 3. 周进度
Const 本周第几天 = 当前日期.GetDay (); // 0=周日
Const 已过周天数 = 本周第几天 === 0 ? 7 : 本周第几天; // 周一为 1 → 周日为 7
Const 剩余周天数 = 7 - 已过周天数;

// ===== 输出结果 =====
TR += `
## 🕰️ 时间进度仪表盘
| 周期  |     进度百分比       | ⏳ 进度条  | 已过时间 | 剩余时间 | 总时长  |
|-------|-------------------|-------------|----------|----------|---------|
| ☀️ 年 | ${(已过天数/全年天数*100). ToFixed (1)}%  | ${生成进度条 (已过天数/全年天数*100)}| ${已过天数}天 | ${剩余天数}天 | ${全年天数}天 |
| 🌙 月 | ${(已过当月天数/当月天数*100). ToFixed (1)}%  | ${生成进度条 (已过当月天数/当月天数*100)} | ${已过当月天数}天 | ${剩余当月天数}天 | ${当月天数}天 |
| ⭐ 周 | ${(已过周天数/7*100). ToFixed (1)}%  | ${生成进度条 (已过周天数/7*100)} | ${已过周天数}天 | ${剩余周天数}天 | 7 天 |
`;
%>
